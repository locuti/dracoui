"use strict";function setUserName(t){global.user||(global.user=t,document.title="["+t+"] "+document.title)}function startTimers(){window.setInterval(function(){global.connected&&global.ws.emit("player_stats")},3e5)}function startListenToSocket(){console.log("Connecting to "+global.config.websocket),startTimers();var t=localStorage.getItem("pokemonSettings");global.pokemonSettings=t?JSON.parse(t):{};var e=io(global.config.websocket,{transports:["websocket","polling"]});global.ws=e,e.on("connect",function(){console.log("Connected to Bot"),global.connected=!0,$(".loading").text("Waiting to get GPS coordinates from client...")}),e.on("disconnect",function(){global.connected=!1}),e.on("initialized",function(t){t.username&&(console.log("Bot Ready."),console.log(t),setUserName(t.username),global.player=t.player,global.player&&($(".player").trigger("pogo:player_update"),ga("send","event","level",global.player.level)),global.storage=t.storage,global.map.addToPath(t.pos)),$(".toolbar div").show(),global.ws.emit("pokemon_settings")}),e.on("pokemon_settings",function(t){global.pokemonSettings=t,localStorage.setItem("pokemonSettings",JSON.stringify(global.pokemonSettings))}),e.on("player_stats",function(t){console.log(t),global.player=t.player,$(".player").trigger("pogo:player_update")}),e.on("position",function(t){global.snipping||global.map.addToPath(t)}),e.on("buildings",function(t){console.log("Update Buildings");var e=Array.from(t.filter(function(t){return 0===t.type}),function(t){return{id:t.id,lat:t.coords.latitude,lng:t.coords.longitude,cooldown:t.pitstop.cooldown,lureExpire:!1}});global.map.addBuildings(e)}),e.on("building_visited",function(t){console.log("Building Visited"),console.log(t),global.map.addVisitedBuilding({id:t.id,name:"",lat:t.coords.latitude,lng:t.coords.longitude,cooldown:t.pitstop.cooldown,visited:!0})}),e.on("creature_caught",function(t){console.log("Creature caught"),console.log(t);var e=t.creature;e.name++,t.position&&(e.lat=t.position.lat,e.lng=t.position.lng),global.map.addCatch(e),creatureToast(e,{ball:e.ball})}),e.on("pokemon_evolved",function(t){creatureToast({id:t.evolution,name:inventory.getPokemonName(t.evolution)},{title:"A "+inventory.getPokemonName(t.pokemon.pokemon_id)+" Evolved"})}),e.on("inventory_list",function(t){console.log(t),global.map.displayInventory(t)}),e.on("creature_list",function(t){console.log(t),global.map.displayCreatureList(t.creatures,null,t.eggs_count)}),e.on("eggs_list",function(t){console.log(t),t.km_walked=t.km_walked||0;var e=t.egg_incubators.filter(function(t){return 0!=t.target_km_walked||0!=t.start_km_walked});e=Array.from(e,function(e){return{type:901==e.item_id?"incubator-unlimited":"incubator",totalDist:e.target_km_walked-e.start_km_walked,doneDist:t.km_walked-e.start_km_walked}});var n=Array.from(t.egg_incubators,function(t){return t.pokemon_id}),i=Array.from(t.eggs.filter(function(t){return n.indexOf(t.id)<0}),function(t){return{type:"egg",totalDist:t.egg_km_walked_target,doneDist:t.egg_km_walked_start}});global.map.displayEggsList(e.concat(i))}),e.on("route",function(t){global.map.setRoute(t)}),e.on("manual_destination_reached",function(){global.map.manualDestinationReached()}),global.ws=e}function errorToast(t){toastr.error(t,"Error",{progressBar:!0,positionClass:"toast-top-right",timeOut:"5000",closeButton:!0})}function creatureToast(t,e){if(!global.config.noPopup){var n=(e=e||{}).title||(global.snipping?"Snipe success":"Catch success"),i=global.snipping?toastr.success:toastr.info,o=t.name;t.level&&(o+=" (lvl "+t.level+")");var a=t.name.toString();1==a.length&&(a="00"+a),2==a.length&&(a="0"+a);var s="<div>"+o+"</div><div>";s+="<img src='./assets/creatures/"+a+".png' height='50' />",e.ball&&(s+="<img src='./assets/inventory/"+e.ball+".png' height='30' />"),i(s+="</div>",n,{progressBar:!0,positionClass:"toast-top-right",timeOut:5e3,closeButton:!0})}}!function(){var t={};t.init=function(t,e){e()},t.getPokemonName=function(t){return t},t.getItemName=function(t){return t},window.inventoryService=t}();var Map=function(t){var e=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),n=L.tileLayer("http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png"),i=L.tileLayer("http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png"),o=L.tileLayer("http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png"),a=L.tileLayer("http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg");this.layerStops=new L.LayerGroup,this.layerCatches=L.markerClusterGroup({maxClusterRadius:30}),this.layerPath=new L.LayerGroup,this.map=L.map(t,{layers:[e,this.layerStops,this.layerCatches,this.layerPath]});var s={OpenStreetMap:e,OpenCycleMap:n,"OpenCycleMap Transport":i,Toner:o,Watercolor:a},r={Path:this.layerPath,Stops:this.layerStops,Catches:this.layerCatches};L.control.layers(s,r).addTo(this.map),this.map.on("baselayerchange",function(t){var e=t.name;localStorage.setItem("layer",e)}.bind(this));var l=localStorage.getItem("layer");l&&$(".leaflet-control-layers-base span:contains('"+l+"')").first().prev().click(),this.map.on("singleclick",function(t){this.setDestination(t.latlng)}.bind(this)),this.path=null,this.route=null,this.destination=null,this.steps=[],this.catches=[],this.stops=[],this.creatureList=[]};Map.prototype.saveContext=function(){var t=Array.from(this.stops,function(t){return{id:t.id,lat:t.lat,lng:t.lng,visited:t.visited}});sessionStorage.setItem("available",!0),sessionStorage.setItem("steps",JSON.stringify(this.steps)),sessionStorage.setItem("catches",JSON.stringify(this.catches)),sessionStorage.setItem("stops",JSON.stringify(t))},Map.prototype.loadContext=function(){try{"true"==sessionStorage.getItem("available")&&(console.log("Load data from storage to restore session"),this.steps=JSON.parse(sessionStorage.getItem("steps"))||[],this.catches=JSON.parse(sessionStorage.getItem("catches"))||[],this.stops=JSON.parse(sessionStorage.getItem("stops"))||[],this.steps.length>0&&this.initPath(),this.initStops(),this.initCatches(),sessionStorage.setItem("available",!1))}catch(t){console.log(t)}},Map.prototype.initPath=function(){if(null!=this.path)return!0;if(!this.me){var t=this.steps[this.steps.length-1];this.map.setView([t.lat,t.lng],16),this.me=L.marker([t.lat,t.lng],{zIndexOffset:200}).addTo(this.map).bindPopup(t.lat.toFixed(4)+","+t.lng.toFixed(4)),$(".loading").hide()}if(this.steps.length>=2){var e=Array.from(this.steps,function(t){return L.latLng(t.lat,t.lng)});return this.path=L.polyline(e,{color:"red"}).addTo(this.layerPath),!0}return!1},Map.prototype.initCatches=function(){for(var t=0;t<this.catches.length;t++){var e=this.catches[t],n=String(e.id);n="0".repeat(3-n.length)+n;var i=L.icon({iconUrl:"./assets/pokemon/"+n+".png",iconSize:[60,60],iconAnchor:[30,30]}),o=e.name+" <br /> Cp:"+e.cp+" Iv:"+e.iv+"%";e.lvl&&(o=e.name+" (lvl "+e.lvl+") <br /> Cp:"+e.cp+" Iv:"+e.iv+"%"),L.marker([e.lat,e.lng],{icon:i,zIndexOffset:100}).bindPopup(o).addTo(this.layerCatches)}},Map.prototype.initStops=function(){for(var t=0;t<this.stops.length;t++){var e=this.stops[t],n=e.visited?"./assets/img/pokestop_visited.png":"./assets/img/pokestop_available.png",i=L.icon({iconUrl:n,iconSize:[40,40],iconAnchor:[20,20]});e.marker=L.marker([e.lat,e.lng],{icon:i,zIndexOffset:50}).bindPopup(e.name).addTo(this.layerStops)}},Map.prototype.addToPath=function(t){if(this.steps.push(t),global.config.memory.limit&&this.steps.length>global.config.memory.mathPath){this.layerPath.clearLayers(),this.path=null;var e=Math.floor(.7*global.config.memory.mathPath);this.steps=this.steps.slice(-e)}if(this.initPath()){var n=L.latLng(t.lat,t.lng);this.path.addLatLng(n),this.me.setLatLng(n).getPopup().setContent(t.lat.toFixed(4)+","+t.lng.toFixed(4)),global.config.followPlayer&&this.map.panTo(n,{animate:!0})}},Map.prototype.addCatch=function(t){if(!t.lat){if(this.steps.length<=0)return;var e=this.steps[this.steps.length-1];t.lat=e.lat,t.lng=e.lng}var n=t.display+"<br /> CP:"+t.cp;if(t.level&&(n=t.display+" (lvl "+t.level+") <br /> CP:"+t.cp),this.catches.push(t),global.config.memory.limit&&this.catches.length>global.config.memory.maxCaught){console.log("Clean catches");var i=Math.floor(.7*global.config.memory.maxCaught);this.catches=this.catches.slice(-i),this.layerCatches.clearLayers(),this.initCatches()}else{var o=String(t.name);o="0".repeat(3-o.length)+o;var a=L.icon({iconUrl:"./assets/creatures/"+o+".png",iconSize:[60,60],iconAnchor:[30,30]});L.marker([t.lat,t.lng],{icon:a,zIndexOffset:100}).bindPopup(n).addTo(this.layerCatches)}},Map.prototype.addVisitedBuilding=function(t){if(t.lat){var e=this.stops.find(function(e){return e.id==t.id});if(e)Object.assign(e,t);else{this.stops.push(t),e=t;var n=L.icon({iconUrl:"./assets/img/pokestop_cooldown.png",iconSize:[40,40],iconAnchor:[20,20]});t.marker=L.marker([t.lat,t.lng],{icon:n,zIndexOffset:50}).addTo(this.layerStops)}e.visited=!0,e&&e.marker&&(e.marker.setIcon(L.icon({iconUrl:"./assets/img/pokestop_cooldown.png",iconSize:[40,40],iconAnchor:[20,20]})),e.name?e.marker.bindPopup(e.name):e.marker.bindPopup(e.id))}},Map.prototype.addBuildings=function(t){for(var e=0;e<t.length;e++){var n=t[e],i=this.stops.find(function(t){return t.id==n.id});i?n=Object.assign(i,n):this.stops.push(n);o="pokestop_available";if(n.cooldown?o="pokestop_cooldown":n.visited&&(o="pokestop_visited"),n.marker)n.marker.setIcon(L.icon({iconUrl:"./assets/img/"+o+".png",iconSize:[40,40],iconAnchor:[20,20]}));else{var o=L.icon({iconUrl:"./assets/img/"+o+".png",iconSize:[40,40],iconAnchor:[20,20]});n.marker=L.marker([n.lat,n.lng],{icon:o,zIndexOffset:50}).addTo(this.layerStops),n.name?n.marker.bindPopup(n.name):n.marker.bindPopup(n.id)}}global.config.memory.limit&&(this.stops.length,global.config.memory.maxPokestops)},Map.prototype.setRoute=function(t){var e=Array.from(t,function(t){return L.latLng(t.lat,t.lng)});null!=this.route?this.route.setLatLngs(e):this.route=L.polyline(e,{dashArray:"5, 5",color:"red",opacity:.4}).addTo(this.layerPath)},Map.prototype.displayCreatureList=function(t,e,n){console.log("Crearture list"),global.active="creature",console.log(t),this.creatureList=t||this.creatureList,this.eggsCount=n||this.eggsCount||0,e?localStorage.setItem("sortCreatureBy",e):e=localStorage.getItem("sortCreatureBy")||"cp",this.creatureList="pokemonId"==e?this.creatureList.sort(function(t,n){if(t[e]!=n[e])return t[e]-n[e];var i=n.cp!=t.cp?"cp":"iv";return n[i]-t[i]}):this.creatureList.sort(function(t,n){if(t[e]!=n[e])return n[e]-t[e];if(t.pokemonId!=n.pokemonId)return t.pokemonId-n.pokemonId;var i="cp"==e?"iv":"cp";return n[i]-t[i]});var i=this.eggsCount+this.creatureList.length;$(".inventory .numberinfo").text(i+"/"+global.storage.creatures);var o=$(".inventory .data");o.html(""),this.creatureList.forEach(function(t){var e=t.favorite?"hide":"",n=t.canEvolve?"":"style='display:none'",i=t.favorite?"set":"unset",a=String(t.name+1);a="0".repeat(3-a.length)+a,o.append('\n            <div class="pokemon '+(t.isBad?"bad":"")+'">\n                <div class="transfer" data-id=\''+t.id+'\'>\n                    <a title=\'(Un)Favorite\' href="#" class="favoriteAction"><img src="./assets/img/favorite_'+i+'.png" /></a>\n                    <a title=\'Transfer\' href="#" class="transferAction '+e+'"><img src="./assets/img/recyclebin.png" /></a>\n                    <a title=\'Evolve\' href="#" class="evolveAction hide"><img src="./assets/img/evolve.png" /></a>\n                </div>\n                <span class="imgspan "><img src="./assets/creatures/'+a+'.png" /></span>\n                <span class="name">'+t.display+" lvl "+t.level+'</span>\n                <span class="info">CP: <strong>'+t.cp+"</strong> IV: <strong>"+t.iv+'%</strong></span>\n                <span class="info hide-on-small-only">ATK: <strong>'+t.attackValue+'</strong> DEF: <strong>0</strong> STA: <strong>0</strong></span>\n                <span class="info">Candy: '+t.candy+"<span "+n+">/"+t.candyToEvolve+"</span></span>\n            </div>\n        ")}),$(".pokemonsort").show(),$(".inventory").show().addClass("active")},Map.prototype.displayEggsList=function(t){console.log("Eggs list"),global.active="eggs",$(".inventory .sort").hide(),$(".inventory .numberinfo").text(t.length+"/9");var e=$(".inventory .data");e.html(""),t.forEach(function(t){t&&e.append('\n                <div class="egg">\n                    <span class="imgspan"><img src="./assets/inventory/'+t.type+'.png" /></span>\n                    <span>'+t.doneDist.toFixed(1)+" / "+t.totalDist.toFixed(1)+" km</span>\n                </div>\n            ")}),$(".inventory").show().addClass("active")},Map.prototype.displayInventory=function(t){console.log("Inventory list"),global.active="inventory",$(".inventory .sort").hide();var e=t.reduce(function(t,e){return t+e.count},0);$(".inventory .numberinfo").text(e+"/"+global.storage.items);var n=$(".inventory .data");n.html(""),t.forEach(function(t){var e=t.removable?"":"hide";n.append('\n            <div class="item">\n                <div class="transfer" data-id=\''+t.type+"' data-count='"+t.count+"'>\n                    <a title='Drop' href=\"#\" class=\"dropItemAction "+e+'"><img src="./assets/img/recyclebin.png" /></a>\n                </div>\n\n                <span class="count">x'+t.count+'</span>\n                <span class="imgspan"><img src="./assets/inventory/'+t.type+'.png" /></span>\n                <span class="info">'+t.display+"</span>\n            </div>\n        ")}),$(".inventory").show().addClass("active")},Map.prototype.setDestination=function(t){var e=L.popup().setLatLng(t).setContent("<div class='dest'>"+t.lat.toFixed(6)+", "+t.lng.toFixed(6)+'</div><div class="center-align"><a class="destBtn waves-effect waves-light btn">Go?</a></div>').openOn(this.map);$(".destBtn").click(function(){this.map.closePopup(e),console.log("Set destination: "+t.lat+", "+t.lng),this.destination&&this.layerPath.removeLayer(this.destination),this.destination=L.marker(t,{zIndexOffset:199,icon:new RedIcon}).bindPopup(t.lat+", "+t.lng).addTo(this.layerPath),global.ws.emit("set_destination",t)}.bind(this))},Map.prototype.manualDestinationReached=function(){this.layerPath.removeLayer(this.destination),this.destination=null};var RedIcon=L.Icon.Default.extend({options:{iconUrl:"assets/img/marker-icon-red.png"}});L.MarkerCluster.prototype.true_initialize=L.MarkerCluster.prototype.initialize,L.MarkerCluster.prototype.initialize=function(t,e,n,i){this.true_initialize(t,e,n,i),this.setZIndexOffset(200)},L.Evented.addInitHook(function(){this._singleClickTimeout=null,this.on("click",this._scheduleSingleClick,this),this.on("dblclick dragstart zoomstart",this._clearSingleClickTimeout.bind(this),this)}),L.Evented.include({_scheduleSingleClick:function(t){this._clearSingleClickTimeout(),this._singleClickTimeout=setTimeout(this._fireSingleClick.bind(this,t),500)},_fireSingleClick:function(t){t.originalEvent._stopped||this.fire("singleclick",L.Util.extend(t,{type:"singleclick"}))},_clearSingleClickTimeout:function(){null!=this._singleClickTimeout&&(clearTimeout(this._singleClickTimeout),this._singleClickTimeout=null)}});var inventory=window.inventoryService;!function(){function t(t,e){n.config.noConfirm?e():vex.dialog.confirm({unsafeMessage:t,callback:function(t){t&&e()}})}function e(){window.ga=window.ga||function(){};var e=localStorage.getItem("sortCreatureBy")||"cp";$("#sortBy"+e).addClass("active").siblings().removeClass("active"),$("#pokemonLink").click(function(){"1"==$(".inventory").css("opacity")&&$(".inventory .data .pokemon").length?$(".inventory").removeClass("active"):n.ws.emit("creature_list")}),$("#eggsLink").click(function(){"1"==$(".inventory").css("opacity")&&$(".inventory .data .egg").length?$(".inventory").removeClass("active"):n.ws.emit("eggs_list")}),$("#inventoryLink").click(function(){"1"==$(".inventory").css("opacity")&&$(".inventory .data .item").length?$(".inventory").removeClass("active"):n.ws.emit("inventory_list")}),$("#sortBypokemonId").click(function(){return n.map.displayCreatureList(null,"pokemonId")}),$("#sortBycp").click(function(){return n.map.displayCreatureList(null,"cp")}),$("#sortByiv").click(function(){return n.map.displayCreatureList(null,"iv")}),$("#sortBypokemonId, #sortBycp, #sortByiv").click(function(){$(this).hasClass("active")||$(this).toggleClass("active").siblings().removeClass("active")}),$(".inventory .refresh").click(function(){console.log("Refresh"),n.ws.emit(n.active+"_list")}),$(".inventory .close").click(function(){$(this).parent().removeClass("active"),$(".inventory .sort").hide()}),$(".message .close").click(function(){$(this).parent().hide()}),$(".close").click(function(){n.active=null}),$("#recycleLink").click(function(){sessionStorage.setItem("available",!1),window.location.reload()}),$("#settingsLink").click(function(){n.map.saveContext(),window.location="config.html"}),$(".inventory .data").on("click","a.transferAction",function(e){e.preventDefault();var i=$(this).parent(),o=i.data().id,a=n.map.creatureList.findIndex(function(t){return t.id==o}),s=n.map.creatureList[a],r=n.map.creatureList.filter(function(t){return t.name==s.name}).length-1;t("Are you sure you want to transfer this "+s.display+"? <br /> You will have <b>"+r+"</b> left.",function(){ga("send","event","transfer",s.display),n.ws.emit("transfer_creature",{id:o}),n.map.creatureList.splice(a,1),i.parent().fadeOut()})}),$(".inventory .data").on("click","a.evolveAction",function(e){e.preventDefault();var i=$(this).parent(),o=i.data().id,a=n.map.creatureList.findIndex(function(t){return t.id==o}),s=n.map.creatureList[a],r=n.map.creatureList.filter(function(t){return t.pokemonId==s.pokemonId}).length-1,l=inventoryService.getPokemonName(s.pokemonId);t("Are you sure you want to evolve this "+l+"? <br /> You will have <b>"+r+"</b> left.",function(){ga("send","event","evolve",l),n.ws.emit("evolve_creature",{id:o}),n.map.creatureList.splice(a,1),i.parent().fadeOut()})}),$(".inventory .data").on("click","a.favoriteAction",function(t){t.preventDefault();var e=$(this).parent(),i=e.data().id,o=n.map.creatureList.findIndex(function(t){return t.id==i}),a=n.map.creatureList[o];a.favorite=!a.favorite;var s=inventoryService.getPokemonName(a.pokemonId);ga("send","event","favorite",s),$(this).find("img").attr("src","./assets/img/favorite_"+(a.favorite?"set":"unset")+".png"),e.find(".transferAction").toggleClass("hide"),n.ws.emit("favorite_creature",{id:i,favorite:a.favorite})}),$(".inventory .data").on("click","a.dropItemAction",function(t){t.preventDefault();var e=$(this).parent(),i=e.data().id,o=inventoryService.getItemName(i),a=e.data().count;vex.dialog.confirm({unsafeMessage:"How many <b>"+o+"</b> would you like to drop?",input:'\n                    <p class="range-field">\n                        <input type="range" name="count" value="1" min="1" max="'+a+"\" onchange=\"$('#display-range').text(this.value)\" />\n                    </p>\n                    Drop: <span id='display-range'>1</span>\n                ",callback:function(t){if(t){var s=parseInt(t.count);ga("send","event","drop_items",o),n.ws.emit("drop_items",{id:i,count:s}),a==s?e.parent().fadeOut():(e.data("count",a-s),e.parent().find(".count").text("x"+(a-s)))}}})}),$(".player").on("pogo:player_update",function(){if(n.player){var t=$(".player");t.find(".playername .value").text(n.user),t.find(".level .value").text(n.player.level);var e=100*n.player.currentExperience/n.player.nextLevelExperience;t.find(".myprogress .value").css("width",e.toFixed(0)+"%"),t.show()}}),n.config.websocket?(n.map=new Map("map"),n.map.loadContext(),startListenToSocket()):window.location="config.html"}var n={storage:{items:350,creatures:250},snipping:!1};window.global=n,n.config=window.configService.load(),n.version=n.config.version,document.title+=" - "+n.version,$(function(){inventoryService.init(n.config.locale,e)})}();try{!function(t,e,n,i,o,a,s){t.GoogleAnalyticsObject=o,t[o]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},t[o].l=1*new Date,a=e.createElement(n),s=e.getElementsByTagName(n)[0],a.async=1,a.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(a,s)}(window,document,"script",0,"ga"),ga("create","UA-81497637-1","auto"),ga("set","checkProtocolTask",null),ga("set","location","http://ui.dracoapi.ml"),ga("send","pageview"),ga("send","event","version",document.title,document.title)}catch(t){window.ga=function(){}}